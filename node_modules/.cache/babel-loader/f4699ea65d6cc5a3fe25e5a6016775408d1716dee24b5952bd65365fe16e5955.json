{"ast":null,"code":"import _toConsumableArray from\"/Users/macpuk/Documents/GitHub/marvel/my-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _classCallCheck from\"/Users/macpuk/Documents/GitHub/marvel/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/macpuk/Documents/GitHub/marvel/my-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/macpuk/Documents/GitHub/marvel/my-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/macpuk/Documents/GitHub/marvel/my-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{Component}from'react';import Spinner from'../spinner/Spinner';import ErrorMessage from'../error/ErrorMessage';import MarvelService from'../../services/MarvelService';import'./charList.scss';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CharList=/*#__PURE__*/function(_Component){_inherits(CharList,_Component);var _super=_createSuper(CharList);function CharList(){var _this;_classCallCheck(this,CharList);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={charList:[],loading:true,error:false,newItemLoading:false,offset:210};_this.marvelService=new MarvelService();_this.onRequest=function(offset){_this.onCharListLoading();_this.marvelService.getAllCharacters(offset).then(_this.onCharListLoaded).catch(_this.onError);};_this.onCharListLoading=function(){_this.setState({newItemLoading:true});};_this.onCharListLoaded=function(newCharList){_this.setState(function(_ref){var offset=_ref.offset,charList=_ref.charList;return{charList:[].concat(_toConsumableArray(charList),_toConsumableArray(newCharList)),loading:false,newItemLoading:false,offset:offset+9};});};_this.onError=function(){_this.setState({error:true,loading:false});};_this.itemRefs=[];_this.setRef=function(ref){_this.itemRefs.push(ref);};_this.focusOnItem=function(id){_this.itemRefs.forEach(function(item){return item.classList.remove('char__item_selected');});_this.itemRefs[id].classList.add('char__item_selected');_this.itemRefs[id].focus();};return _this;}_createClass(CharList,[{key:\"componentDidMount\",value:function componentDidMount(){this.onRequest();}},{key:\"renderItems\",value:function renderItems(arr){var _this2=this;var items=arr.map(function(item,i){var imgStyle={'objectFit':'cover'};if(item.thumbnail==='http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg'){imgStyle={'objectFit':'unset'};}return/*#__PURE__*/_jsxs(\"li\",{className:\"char__item\",ref:_this2.setRef,onClick:function onClick(){_this2.props.onCharSelected(item.id);_this2.focusOnItem(i);},onKeyPress:function onKeyPress(e){if(e.key===' '||e.key===\"Enter\"){_this2.props.onCharSelected(item.id);_this2.focusOnItem(i);}},children:[/*#__PURE__*/_jsx(\"img\",{src:item.thumbnail,alt:item.name,style:imgStyle}),/*#__PURE__*/_jsx(\"div\",{className:\"char__name\",children:item.name})]},item.id);});// А эта конструкция вынесена для центровки спиннера/ошибки\nreturn/*#__PURE__*/_jsx(\"ul\",{className:\"char__grid\",children:items});}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,charList=_this$state.charList,loading=_this$state.loading,error=_this$state.error,offset=_this$state.offset,newItemLoading=_this$state.newItemLoading;var items=this.renderItems(charList);var errorMessage=error?/*#__PURE__*/_jsx(ErrorMessage,{}):null;var spinner=loading?/*#__PURE__*/_jsx(Spinner,{}):null;var content=!(loading||error)?items:null;return/*#__PURE__*/_jsxs(\"div\",{className:\"char__list\",children:[errorMessage,spinner,content,/*#__PURE__*/_jsx(\"button\",{className:\"button button__main button__long\",disabled:newItemLoading,onClick:function onClick(){return _this3.onRequest(offset);},children:/*#__PURE__*/_jsx(\"div\",{className:\"inner\",children:\"load more\"})})]});}}]);return CharList;}(Component);export default CharList;","map":{"version":3,"names":["Component","Spinner","ErrorMessage","MarvelService","CharList","state","charList","loading","error","newItemLoading","offset","marvelService","onRequest","onCharListLoading","getAllCharacters","then","onCharListLoaded","catch","onError","setState","newCharList","itemRefs","setRef","ref","push","focusOnItem","id","forEach","item","classList","remove","add","focus","arr","items","map","i","imgStyle","thumbnail","props","onCharSelected","e","key","name","renderItems","errorMessage","spinner","content"],"sources":["/Users/macpuk/Documents/GitHub/marvel/my-app/src/components/charList/CharList.js"],"sourcesContent":["import {Component} from 'react';\nimport PropTypes from 'prop-types'\nimport Spinner from '../spinner/Spinner';\nimport ErrorMessage from '../error/ErrorMessage';\nimport MarvelService from '../../services/MarvelService';\nimport './charList.scss';\n\nclass CharList extends Component {\n\n    state = {\n        charList: [],\n        loading: true,\n        error: false,\n        newItemLoading: false,\n        offset: 210\n    }\n    \n    marvelService = new MarvelService();\n\n    componentDidMount() {\n        this.onRequest();\n    }\n\n    onRequest = (offset) => {\n        this.onCharListLoading();\n        this.marvelService.getAllCharacters(offset)\n            .then(this.onCharListLoaded)\n            .catch(this.onError)\n    }\n\n    onCharListLoading = () => {\n        this.setState({\n            newItemLoading: true\n        })\n    }\n\n    onCharListLoaded = (newCharList) => {\n        this.setState(({offset,charList}) => ({\n            charList: [...charList, ...newCharList],\n            loading: false,\n            newItemLoading: false,\n            offset: offset + 9\n        }))\n    }\n\n    onError = () => {\n        this.setState({\n            error: true,\n            loading: false\n        })\n    }\n\n    itemRefs = [];\n\n    setRef = (ref) => {\n        this.itemRefs.push(ref);\n    }\n\n    focusOnItem = (id) => {\n        this.itemRefs.forEach(item => item.classList.remove('char__item_selected'));\n        this.itemRefs[id].classList.add('char__item_selected');\n        this.itemRefs[id].focus();\n    }\n\n    renderItems(arr) {\n        const items =  arr.map((item, i) => {\n            let imgStyle = {'objectFit' : 'cover'};\n            if (item.thumbnail === 'http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg') {\n                imgStyle = {'objectFit' : 'unset'};\n            }\n            \n            return (\n                <li \n                    className=\"char__item\"\n                    key={item.id}\n                    ref={this.setRef}\n                    onClick={() => { this.props.onCharSelected(item.id);\n                                    this.focusOnItem(i);\n                    }}\n                    onKeyPress={(e) => {\n                        if (e.key === ' ' || e.key === \"Enter\") {\n                            this.props.onCharSelected(item.id);\n                            this.focusOnItem(i);\n                        }\n                    }}>\n                        <img src={item.thumbnail} alt={item.name} style={imgStyle}/>\n                        <div className=\"char__name\">{item.name}</div>\n                </li>\n            )\n        });\n        // А эта конструкция вынесена для центровки спиннера/ошибки\n        return (\n            <ul className=\"char__grid\">\n                {items}\n            </ul>\n        )\n    }\n\n    render() {\n\n        const {charList, loading, error, offset, newItemLoading} = this.state;\n        \n        const items = this.renderItems(charList);\n\n        const errorMessage = error ? <ErrorMessage/> : null;\n        const spinner = loading ? <Spinner/> : null;\n        const content = !(loading || error) ? items : null;\n\n        return (\n            <div className=\"char__list\">\n                {errorMessage}\n                {spinner}\n                {content}\n                <button \n                    className=\"button button__main button__long\"\n                    disabled={newItemLoading}\n                    onClick={() => this.onRequest(offset)}>\n                    <div className=\"inner\">load more</div>\n                </button>\n            </div>\n        )\n    }\n}\n\n\nexport default CharList;"],"mappings":"koBAAA,OAAQA,SAAS,KAAO,OAAO,CAE/B,MAAOC,QAAO,KAAM,oBAAoB,CACxC,MAAOC,aAAY,KAAM,uBAAuB,CAChD,MAAOC,cAAa,KAAM,8BAA8B,CACxD,MAAO,iBAAiB,CAAC,2FAEnBC,SAAQ,mUAEVC,KAAK,CAAG,CACJC,QAAQ,CAAE,EAAE,CACZC,OAAO,CAAE,IAAI,CACbC,KAAK,CAAE,KAAK,CACZC,cAAc,CAAE,KAAK,CACrBC,MAAM,CAAE,GACZ,CAAC,OAEDC,aAAa,CAAG,GAAIR,cAAa,EAAE,OAMnCS,SAAS,CAAG,SAACF,MAAM,CAAK,CACpB,MAAKG,iBAAiB,EAAE,CACxB,MAAKF,aAAa,CAACG,gBAAgB,CAACJ,MAAM,CAAC,CACtCK,IAAI,CAAC,MAAKC,gBAAgB,CAAC,CAC3BC,KAAK,CAAC,MAAKC,OAAO,CAAC,CAC5B,CAAC,OAEDL,iBAAiB,CAAG,UAAM,CACtB,MAAKM,QAAQ,CAAC,CACVV,cAAc,CAAE,IACpB,CAAC,CAAC,CACN,CAAC,OAEDO,gBAAgB,CAAG,SAACI,WAAW,CAAK,CAChC,MAAKD,QAAQ,CAAC,kBAAET,OAAM,MAANA,MAAM,CAACJ,QAAQ,MAARA,QAAQ,OAAO,CAClCA,QAAQ,8BAAMA,QAAQ,qBAAKc,WAAW,EAAC,CACvCb,OAAO,CAAE,KAAK,CACdE,cAAc,CAAE,KAAK,CACrBC,MAAM,CAAEA,MAAM,CAAG,CACrB,CAAC,EAAC,CAAC,CACP,CAAC,OAEDQ,OAAO,CAAG,UAAM,CACZ,MAAKC,QAAQ,CAAC,CACVX,KAAK,CAAE,IAAI,CACXD,OAAO,CAAE,KACb,CAAC,CAAC,CACN,CAAC,OAEDc,QAAQ,CAAG,EAAE,OAEbC,MAAM,CAAG,SAACC,GAAG,CAAK,CACd,MAAKF,QAAQ,CAACG,IAAI,CAACD,GAAG,CAAC,CAC3B,CAAC,OAEDE,WAAW,CAAG,SAACC,EAAE,CAAK,CAClB,MAAKL,QAAQ,CAACM,OAAO,CAAC,SAAAC,IAAI,QAAIA,KAAI,CAACC,SAAS,CAACC,MAAM,CAAC,qBAAqB,CAAC,GAAC,CAC3E,MAAKT,QAAQ,CAACK,EAAE,CAAC,CAACG,SAAS,CAACE,GAAG,CAAC,qBAAqB,CAAC,CACtD,MAAKV,QAAQ,CAACK,EAAE,CAAC,CAACM,KAAK,EAAE,CAC7B,CAAC,qEA3CD,4BAAoB,CAChB,IAAI,CAACpB,SAAS,EAAE,CACpB,CAAC,2BA2CD,qBAAYqB,GAAG,CAAE,iBACb,GAAMC,MAAK,CAAID,GAAG,CAACE,GAAG,CAAC,SAACP,IAAI,CAAEQ,CAAC,CAAK,CAChC,GAAIC,SAAQ,CAAG,CAAC,WAAW,CAAG,OAAO,CAAC,CACtC,GAAIT,IAAI,CAACU,SAAS,GAAK,qEAAqE,CAAE,CAC1FD,QAAQ,CAAG,CAAC,WAAW,CAAG,OAAO,CAAC,CACtC,CAEA,mBACI,YACI,SAAS,CAAC,YAAY,CAEtB,GAAG,CAAE,MAAI,CAACf,MAAO,CACjB,OAAO,CAAE,kBAAM,CAAE,MAAI,CAACiB,KAAK,CAACC,cAAc,CAACZ,IAAI,CAACF,EAAE,CAAC,CACnC,MAAI,CAACD,WAAW,CAACW,CAAC,CAAC,CACnC,CAAE,CACF,UAAU,CAAE,oBAACK,CAAC,CAAK,CACf,GAAIA,CAAC,CAACC,GAAG,GAAK,GAAG,EAAID,CAAC,CAACC,GAAG,GAAK,OAAO,CAAE,CACpC,MAAI,CAACH,KAAK,CAACC,cAAc,CAACZ,IAAI,CAACF,EAAE,CAAC,CAClC,MAAI,CAACD,WAAW,CAACW,CAAC,CAAC,CACvB,CACJ,CAAE,wBACE,YAAK,GAAG,CAAER,IAAI,CAACU,SAAU,CAAC,GAAG,CAAEV,IAAI,CAACe,IAAK,CAAC,KAAK,CAAEN,QAAS,EAAE,cAC5D,YAAK,SAAS,CAAC,YAAY,UAAET,IAAI,CAACe,IAAI,EAAO,GAZ5Cf,IAAI,CAACF,EAAE,CAaX,CAEb,CAAC,CAAC,CACF;AACA,mBACI,WAAI,SAAS,CAAC,YAAY,UACrBQ,KAAK,EACL,CAEb,CAAC,sBAED,iBAAS,iBAEL,gBAA2D,IAAI,CAAC7B,KAAK,CAA9DC,QAAQ,aAARA,QAAQ,CAAEC,OAAO,aAAPA,OAAO,CAAEC,KAAK,aAALA,KAAK,CAAEE,MAAM,aAANA,MAAM,CAAED,cAAc,aAAdA,cAAc,CAEvD,GAAMyB,MAAK,CAAG,IAAI,CAACU,WAAW,CAACtC,QAAQ,CAAC,CAExC,GAAMuC,aAAY,CAAGrC,KAAK,cAAG,KAAC,YAAY,IAAE,CAAG,IAAI,CACnD,GAAMsC,QAAO,CAAGvC,OAAO,cAAG,KAAC,OAAO,IAAE,CAAG,IAAI,CAC3C,GAAMwC,QAAO,CAAG,EAAExC,OAAO,EAAIC,KAAK,CAAC,CAAG0B,KAAK,CAAG,IAAI,CAElD,mBACI,aAAK,SAAS,CAAC,YAAY,WACtBW,YAAY,CACZC,OAAO,CACPC,OAAO,cACR,eACI,SAAS,CAAC,kCAAkC,CAC5C,QAAQ,CAAEtC,cAAe,CACzB,OAAO,CAAE,yBAAM,OAAI,CAACG,SAAS,CAACF,MAAM,CAAC,EAAC,uBACtC,YAAK,SAAS,CAAC,OAAO,UAAC,WAAS,EAAM,EACjC,GACP,CAEd,CAAC,sBAlHkBV,SAAS,EAsHhC,cAAeI,SAAQ"},"metadata":{},"sourceType":"module","externalDependencies":[]}